!function(t,e,a,o){var n,r="threeSixty",i={dragDirection:"horizontal",useKeys:!1,draggable:!0},s=["horizontal","vertical"],d={},c={},l=[];function u(e,a){n=this,this.element=e,d=d=t.extend({},i,a),this._defaults=i,this._name=r,t.inArray(d.dragDirection,s)<0&&(d.dragDirection=i.dragDirection),this.init()}t.fn.destroy=u.prototype.destroy=function(){!0===d.useKeys&&t(a).unbind("keydown",this.onKeyDown),t(this).removeData(),c.html("")},t.fn.nextFrame=u.prototype.nextFrame=function(){t(this).each(function(e){var a=t(this),o=a.data("lastVal")||0,n=a.data("count");o+=1,a.data("lastVal",o),o>=n?o%=n-1:o<=-n&&(o%=n-1),o>0&&(o=n-o),o=Math.abs(o),a.find(".threesixty-frame").css({display:"none"}),a.find(".threesixty-frame:eq("+o+")").css({display:"block"})})},t.fn.prevFrame=u.prototype.prevFrame=function(){t(this).each(function(e){var a=t(this),o=a.data("lastVal")||0,n=a.data("count");o-=1,a.data("lastVal",o),o>=n?o%=n-1:o<=-n&&(o%=n-1),o>0&&(o=n-o),o=Math.abs(o),a.find(".threesixty-frame").css({display:"none"}),a.find(".threesixty-frame:eq("+o+")").css({display:"block"})})},u.prototype.init=function(){var e=t(this.element);c=e,e.each(function(){var e=t(this),a=e.data("path"),o=e.data("count");l.push({path:a,count:o,loaded:0,$el:e}),o}),g(),this.initLoad()},u.prototype.initLoad=function(){var e,a,o=0,n=l.length;for(c.addClass("preloading");o<n;o++)for(a=0;a<l[o].count;a++)e=l[o].path.replace("{index}",a),t("<img/>").data("index",o).attr("src",e).on("load",this.onLoadComplete)},u.prototype.onLoadComplete=function(e){var a=t(e.currentTarget).data("index"),o=l[a];o.loaded++,o.loaded===o.count&&n.onLoadAllComplete(a)},u.prototype.onLoadAllComplete=function(t){var e=l[t].$el,a="",o=l[t].count,n=l[t].path,r=0;for(e.html(""),e.removeClass("preloading");r<o;r++){a+='<img class="threesixty-frame" style="display:'+(0===r?"block":"none")+';" data-index="'+r+'" src="'+n.replace("{index}",r)+'"/>'}e.html(a),this.attachHandlers(t)};var h=0,p=null,f=0,y=0,v=0,m=!1;u.prototype.attachHandlers=function(e){var o=this,n=l[e].$el;if(d.draggable&&void 0!==a.ontouchstart&&void 0!==a.ontouchmove&&void 0!==a.ontouchend&&void 0!==a.ontouchcancel){var r=n.get()[0];r.addEventListener("touchstart",o.onTouchStart),r.addEventListener("touchmove",o.onTouchMove),r.addEventListener("touchend",o.onTouchEnd),r.addEventListener("touchcancel",o.onTouchEnd)}n.mousedown(function(e){e.preventDefault(),h=t(this).data("count"),p=t(this),e.screenY,v=p.data("lastVal")||0,y=p.data("lastX")||0,f=p.data("lastY")||0,m=!0,p.trigger("down")}),!0===d.useKeys&&t(a).bind("keydown",o.onKeyDown),t(a,"html","body").mouseup(o.onMouseUp),t(a).blur(o.onMouseUp),t("body").mousemove(function(t){o.onMove(t.screenX,t.screenY)})},u.prototype.onTouchStart=function(e){var a=e.touches[0];e.preventDefault(),p=t(e.target).parent(),h=p.data("count"),startX=a.pageX,a.pageY,v=p.data("lastVal")||0,y=p.data("lastX")||0,f=p.data("lastY")||0,m=!0,p.trigger("down")},u.prototype.onTouchMove=function(t){t.preventDefault();var e=t.touches[0];n.onMove(e.pageX,e.pageY)},u.prototype.onTouchEnd=function(t){},u.prototype.onMove=function(t,e){if(m){var a=t,o=e,n=0;if(p.trigger("move"),"vertical"===d.dragDirection)n=o>f?v+1:v-1;else if(a>y)n=v+1;else{if(a===y)return;n=v-1}v=n,f=o,y=a,p.data("lastY",f),p.data("lastX",y),p.data("lastVal",v),n>=h?n%=h-1:n<=-h&&(n%=h-1),n>0&&(n=h-n),n=Math.abs(n),p.find(".threesixty-frame").css({display:"none"}),p.find(".threesixty-frame:eq("+n+")").css({display:"block"})}},u.prototype.onKeyDown=function(t){switch(t.keyCode){case 37:c.prevFrame();break;case 39:c.nextFrame()}},u.prototype.onMouseUp=function(t){m=!1,p.trigger("up")};var g=function(){a.body.onselectstart=function(){return!1},a.body.ondragstart=function(){return!1}};t.fn[r]=function(e){return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new u(this,e))})}}(jQuery,window,document);